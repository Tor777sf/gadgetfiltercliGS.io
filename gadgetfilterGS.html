<!--segundo nivel 2.8.-->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Sheet CSV</title>
<!-- Bulma CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<!-- Popper.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css">

<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">

<!-- WhatsApp Click to Chat JS -->
<script src="https://cdn.jsdelivr.net/npm/whatsapp-click-to-chat/dist/index.min.js"></script>

<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>

<!-- PapaParse JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

  <!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.min.js"></script>

<!-- PDFLib JS -->
<script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>

<!-- jsPDF JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

  <style>
    /* Coloca aqu√≠ el bloque de estilos CSS */
    .shopping-item {
      font-size: 16px;
      list-style-type: none;
      padding: 8px 0;
      border-bottom: 1px solid #ccc;
    }

    .item-quantity {
      display: inline-block;
      width: 10%;
    }

    .item-description {
      display: inline-block;
      width: 50%;
    }

    .item-total {
      display: inline-block;
      width: 30%;
      text-align: right;
    }
    /* _--------------------------------*/
        /* Personalizaci√≥n de la tabla DataTable */
    .dataTables_wrapper {
      background-color: #ffffff; /* Fondo dorado para el contenedor de la tabla */
      padding: 20px;
    }

    #myDataTable th {
      color: #000080; /* Color azul marino para los encabezados de columna */
      font-weight: bold; /* Texto en negrita */
    }

    
    #myDataTable td:nth-child(1) {
      color: #000080; /* Color Azul marino para el texto de la columna de precio */
    }
    
/* Estilos para la parte interior de la tabla DataTable */
.dataTables_wrapper .dataTables_empty {
  background-color: #40e0d0; /* Color de fondo para la parte interior */
  color: #333; /* Color del texto */
  font-size: 18px; /* Tama√±o del texto */
  text-align: center; /* Centrar el texto */
  padding: 20px; /* Espaciado interno */
}

/* Estilos para las filas de la tabla DataTable */
#myDataTable tbody tr {
  background: linear-gradient(to bottom, #000000 0%, #000080 100%); /* Efecto de esfumado vertical */
}


  /* Estilos alternados para filas de la tabla DataTable */
   #myDataTable tbody tr:nth-child(odd) {
     background-color: #66cdaa; /* Color de fondo para las filas impares */
   }

   #myDataTable tbody tr:nth-child(even) {
     background-color: #ffffff; /* Color de fondo para las filas pares */
   }

    /* Estilos para las filas de la tabla DataTable */
  #myDataTable tbody tr {
  animation: fadeInRow 0.5s ease; /* Agregar animaci√≥n de desvanecimiento */
}

/* Animaci√≥n de desvanecimiento */
@keyframes fadeInRow {
  from {
    opacity: 0; /* Comienza con opacidad cero (invisible) */
  }
  to {
    opacity: 1; /* Termina con opacidad completa (visible) */
  }
}
    
    #myDataTable tbody td:nth-child(3) {
    width: auto; /* Ancho autom√°tico */
    height: auto; /* Alto autom√°tico */
    padding: 5px; /* Ajustar el relleno seg√∫n sea necesario */
}

    #myDataTable tbody td:nth-child(2) {
    width: auto; /* Ancho autom√°tico */
    height: auto; /* Alto autom√°tico */
    padding: 5px; /* Ajustar el relleno seg√∫n sea necesario */
    color: red; /* Color rojo para el texto de la columna de precio */

}
    #myDataTable tbody td {
    border-radius: 0%; /* Establecer el radio para crear un borde circular */
    overflow: hidden; /* Ocultar cualquier contenido que sobresalga del borde circular */
}


.lista-de-compra {
    position: fixed;
    /*bottom: 0;*/
    width: 100%;
    max-height: 80%;
    overflow-y: auto;
    background-image: url('https://i.postimg.cc/jjvZJL1V/JPG-LOGO-DISTRIBUCIONESDIAZ.jpg');
    background-size: 120px; /* Tama√±o deseado para la imagen */
    background-position: right top; /* Ajusta la posici√≥n de la imagen */
    background-repeat: no-repeat; /* Evita que la imagen se repita */
    background-color: #fff;
    padding: 10px;
    box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
    z-index: 1000;
}






/* Estilos para la secci√≥n de shoppingItems */
.shopping-items {
    display: none; /* Ocultar la lista de √≠tems por defecto */
}

/* Estilos para mostrar la secci√≥n de shoppingItems al deslizar hacia arriba */
.shopping-items.mostrar {
    display: block; /* Mostrar la lista de √≠tems */
}
#container {
    display: flex;
    flex-direction: column;
}


  </style>

</head>
<body>

<div id="container">
    
    <div style="height: 100px;"></div>

    <!-- Nueva secci√≥n para la lista de compra -->
    <div id="shoppingList" class="lista-de-compra">
        <h4>Distribuciones Diaz E.I.R.L.</h4>


        <div id="documentOptions">
            <!-- Opciones de documento: Nota de Venta, Cotizaci√≥n, Nota de Pedido, Lista de Compra -->
            <label for="documentType">Tipo de Documento>:</label>
            <select id="documentType" name="documentType">
                <option value="notaPedido">Nota de Pedido</option>
                <option value="notaVenta">Nota de Venta</option>
                <option value="cotizacion">Cotizaci√≥n</option>
                <option value="listaCompra">Lista de Compra</option>
            </select>
        </div>

        <!-- Opciones de entrega: Delivery, Recojo en tienda -->
        <div id="deliveryOptions">
            <label for="deliveryOption">Opciones de entrega:</label>
            <select id="deliveryOption" name="deliveryOption">
                <option value="delivery">Delivery</option>
                <option value="pickup">Recojo en tienda</option>
            </select>
        </div>

        <!-- Enlace para mostrar/ocultar √≠tems -->
        <a href="#" id="toggleItemsLink">Mostrar √≠tems</a>
        <ul id="shoppingItems" class="shopping-items">
            <!-- Campos de entrada para cliente, direcci√≥n y celular -->
            <li>
                <label for="clientName">Clienteüë•:</label>
                <input type="text" id="clientName" name="clientName">
            </li>
            <li>
                <label for="clientAddress">Direcci√≥n:</label>
                <input type="text" id="clientAddress" name="clientAddress">
            </li>
            <li>
                <label for="clientPhone">Celularüì±</label>
                <input type="text" id="clientPhone" name="clientPhone">
            </li>

            <!-- Los √≠tems de la lista de compra se agregar√°n aqu√≠ din√°micamente -->
        </ul>
        <p>Total de Compra: <span id="totalPurchase">$0.00</span></p>
        <button id="whatsappButton">Compartir por WhatsApp</button>
        <button id="downloadPDFButton">Descargar PDF</button>
    </div>
</div>

  
   <div style="height: 60px;"></div>
   <table id="myDataTable" class="display">
        <!-- DataTable content will be dynamically generated here -->
    </table>
    </div>





<script>
  // Capturar errores de JavaScript y mostrarlos en una alerta
window.onerror = function(message, source, lineno, colno, error) {
    alert("Error: " + message + "\n" + "File: " + source + "\n" + "Line: " + lineno);
    return true; // Evitar que el navegador muestre su propio mensaje de error en la consola
};


// Obtener la secci√≥n de shoppingItems
var shoppingItems = document.getElementById("shoppingItems");

// Obtener el enlace de mostrar/ocultar √≠tems
var toggleItemsLink = document.getElementById("toggleItemsLink");

// Agregar un evento de clic al enlace
toggleItemsLink.addEventListener("click", function(event) {
    // Evita que el enlace ejecute su comportamiento predeterminado
    event.preventDefault();
    
    // Alternar la clase "mostrar" en la lista de compras
    shoppingItems.classList.toggle("mostrar");
    
    // Cambiar el texto del enlace seg√∫n el estado de la lista de compras
    if (shoppingItems.classList.contains("mostrar")) {
        toggleItemsLink.textContent = "Ocultar √≠tems";
    } else {
        toggleItemsLink.textContent = "Mostrar √≠tems";
    }
});



  
  $(document).ready(function () {
   // Descargar y parsear el archivo CSV
    Papa.parse('https://docs.google.com/spreadsheets/d/1X0WN5st8Bl6G6_QPtC9gS6vY4PyFR5dAjXxWU7UiOYE/export?format=csv&gid=0', {
      download: true,
      header: true,
      dynamicTyping: true,
  //###############################################
    complete: function (results) {
      //?????????????????????????....????????
        // Agregar el precio a la descripci√≥n
     
      ///results.data.forEach(function(row) {
      ///  row.DESCRIPCION = row.DESCRIPCION + '<br><span style="font-weight: bold; color: red;">Precio: S/' + row.Total + '</span>';
        //row.DESCRIPCION = row.DESCRIPCION + '<br>Precio: $' + row.Total;
       /// });
      //????????????????????????????????
              // Copiar la descripci√≥n original antes de modificarla
                results.data.forEach(function(row) {
            // Agregar precio a la descripci√≥n original
            row.DESCRIPCION_CON_PRECIO = row.DESCRIPCION + '<br><span style="font-weight: bold; color: red;">Precio: S/' + row.Total + '</span>';
        });
      //????????????????????????.......???????????
    // Crear DataTable
     var dataTable = $('#myDataTable').DataTable({
          data: results.data,
          columns: [
              { data: 'DESCRIPCION_CON_PRECIO', title: 'DESCRIPCION' }, // Columna 1: DESCRIPCION
              //{ data: 'Total', title: 'PRECIO' }, // Columna 9: PRECIO
              { data: 'ENLACES', title: 'IMAGENES' } // Columna 10: IMAGENES
          ],
          columnDefs: [
              {
                  targets: [1], // √çndice de la columna 10
                  render: function (data, type, row) {
                    // Personalizar renderizado para la columna 10 con enlaces no vac√≠os
                    return data && data !== "" ? '<img src="' + data + '" alt="Ver Foto" style="height: auto; width: 500px;" />' : "";
                }
            }
        ]
    });


      
  //################################################    
      
    ///  complete: function (results) {
        // Crear DataTable
     ///   var dataTable = $('#myDataTable').DataTable({
      ///    data: results.data,
     ///     columns: Object.keys(results.data[0]).map(function(key) {
      ///      return { data: key, title: key };
      ///    }),
     ///     columnDefs: [
       ///     {
      ///        targets: 10,
     ///         render: function (data, type, row) {
                // Personalizar renderizado para la columna con enlaces no vac√≠os
        ///      return data && data !== "" ? '<img src="' + data + '" alt="Ver Foto" style="height: 100px; width: auto;" />' : "";

              //  return data && data !== "" ? '<a href="' + data + '" target="_blank"><img src="' + data + '" alt="Ver Foto" style="height: 100px; width: auto;" /></a>' : "";
       ///       }
      ///      }
     ///     ]
    ///    });
//######################################################
 

        // Nueva lista de compra
        var shoppingList = [];
        var totalPurchase = 0;

// ...

        
$('#priceInput').click(function() {
    // Seleccionar todo el texto dentro del campo de entrada
    $(this).select();
    // Eliminar la propiedad 'readonly'
    $(this).removeAttr('readonly');
});

// Validar que solo se ingresen n√∫meros durante la edici√≥n del precio
$('#priceInput').on('input', function() {
    var sanitized = $(this).val().replace(/[^0-9.]/g, '');
    $(this).val(sanitized);
});

// Capturar el valor del precio antes de la edici√≥n
var previousPrice;
var nuevoProducto;
        
//$('#priceInput').focus(function() {
  //  previousPrice = $(this).val();
//});

// Al perder el enfoque del campo de precio, verificar y ajustar la cantidad si es necesario
$('#priceInput').change(function() {
    // Verificar el valor de nuevoProducto
    if (nuevoProducto === "si") {
          //si nuevoProducto es "si"
         previousPrice = $('#priceInput').val();

        return;
    } else if (nuevoProducto === "no") {
        var newPrice = parseFloat($(this).val());

        // Verificar si el nuevo precio es menor o igual que el precio anterior
        if (newPrice <= parseFloat(previousPrice)) {
            var quantity = parseFloat($('#quantityInput').val()); // Obtener la cantidad ingresada
            if (!isNaN(quantity) && quantity > 0) {
                // Calcular la nueva cantidad
                var newQuantity = (quantity / parseFloat(previousPrice)) * newPrice;

                $('#quantityInput').val(newQuantity.toFixed(2)); // Actualizar el campo de cantidad
            }
        } else {
            // Si el nuevo precio es mayor o igual que el precio anterior
            // Establecer la cantidad como el nuevo precio dividido por el precio anterior
            $('#quantityInput').val((newPrice / parseFloat(previousPrice)).toFixed(2));
        }
    }

    // Volver a establecer el campo de precio como de solo lectura
    //$(this).attr('readonly', true);
});

// Al cambiar el valor de cantidad
$('#quantityInput').change(function() {
    // Verificar si el producto es "no" y si la cantidad ha sido editada
    if (nuevoProducto === "no") {
        // Establecer el valor del campo de precio como previousPrice
        $('#priceInput').val(previousPrice);
    }
});

    
// Convertir precio a n√∫mero con punto decimal
function convertirPrecio(precio) {
    // Verificar si el precio es un n√∫mero
    if (!isNaN(precio)) {
        // Si el precio es un n√∫mero v√°lido, simplemente devolverlo
        return parseFloat(precio);
    } else if (precio.trim() !== '') {
        // Si el precio no es un n√∫mero y no est√° vac√≠o, intentar limpiar y convertirlo
        // Eliminar cualquier car√°cter que no sea d√≠gito o punto
        precio = precio.replace(/[^\d,.]/g, '');

           //precio = precio.replace(/[^\d,.]/g, '');
      //Reemplasa coma por punto  
       precio = precio.replace(',', '.');
        // Convertir el string limpio a n√∫mero
        return parseFloat(precio);
    } else {
        // Si el precio est√° vac√≠o, nulo o es 0, devolver 0
        return 0;
    }
}

// Capturar el evento clic al seleccionar un √≠tem en la tabla
$('#myDataTable tbody').on('click', 'tr', function () {
    try {
        var data = dataTable.row(this).data(); // Obtener datos de la fila clicada

        // Verificar si la descripci√≥n del producto est√° definida
        if (data && data.DESCRIPCION) {
            // Mostrar el formulario modal
            $('#quantityModal').modal('show');

            // Verificar si la descripci√≥n del producto es "xp" (sin diferenciar may√∫sculas y min√∫sculas)
            var descripcion = data.DESCRIPCION.toLowerCase(); // Convertir la descripci√≥n a min√∫sculas
            var precio = convertirPrecio(data.Total); // Convertir el precio a n√∫mero con punto decimal
            var imageLink = ""; // Enlace de la imagen por defecto

            if (descripcion === "xp") {
                // Si la descripci√≥n es "xp", establecer la descripci√≥n, el precio y la imagen como vac√≠os
                $('#descriptionInput').val("");
                $('#priceInput').val("0.00");
                $('#imageContainer').html(""); // Limpiar el contenedor de imagen
                previousPrice = 0;
                nuevoProducto="si";

            } else {
                // Si la descripci√≥n no es "xp", establecer la descripci√≥n y el precio seg√∫n los datos de la fila
                 // var descripcion = $('<div>').html(data.DESCRIPCION).text(); // Obtener la descripci√≥n sin HTML
                //$('#descriptionInput').val(descripcion.trim()); // Establecer la descripci√≥n en el textarea

                $('#descriptionInput').val(data.DESCRIPCION);
                // Verificar si el precio es 0, mostrar "0.00", de lo contrario, mostrar el precio formateado con dos decimales
                $('#priceInput').val(precio === 0 ? '0.00' : precio.toFixed(2));
                imageLink = data.ENLACES; // Obtener el enlace de la imagen directamente de la columna "ENLACES"
                previousPrice = $('#priceInput').val();
                nuevoProducto="no";
            }

            if (imageLink) {
                // Mostrar la imagen en el modal
                $('#imageContainer').html('<img src="' + imageLink + '" alt="Imagen del producto">');
            } else {
                $('#imageContainer').html('Imagen no disponible');
            }

            // Capturar el evento clic del bot√≥n "Agregar" en el formulario modal
            $('#addQuantityBtn').off('click').on('click', function () {
                try {
                    var quantity = $('#quantityInput').val(); // Obtener la cantidad ingresada
                    var price = $('#priceInput').val(); // Obtener el precio
                    if (!quantity || isNaN(quantity) || quantity <= 0 || !price || isNaN(price) || price <= 0) {
                        alert('La cantidad y el precio deben ser n√∫meros positivos.');
                        return;
                    }

                    // La cantidad y el precio son v√°lidos, procede con el proceso de agregar a la lista de compra
                    var totalItem = parseFloat(price) * parseFloat(quantity);
                    totalPurchase += totalItem;

                    shoppingList.push({
                    producto: $('#descriptionInput').val(), // Obtener el valor del campo de descripci√≥n
                    cantidad: quantity,
                    precio: previousPrice, // Agregar el precio modificado a la lista de compras
                    total: totalItem.toFixed(2),
                    });


                    updateShoppingList();

                    $('#quantityModal').modal('hide'); // Ocultar el formulario modal
                } catch (error) {
                    alert('Error al agregar la cantidad: ' + error.message);
                }
            });
        } else {
            alert('Descripci√≥n del producto no definida. Intente de nuevo.');
        }
    } catch (error) {
        alert('Error al procesar el clic en la tabla: ' + error.message);
    }
});


//:: fin Agregar evento clic para generar lista de compra
        
// .

// ...
//   inicio botones Whatsapp y pdf

// Funci√≥n para formatear la lista de compra para WhatsApp
//wwewwwwwwwwwwwwwwww
// Funci√≥n para formatear la lista de compra para WhatsApp
// Funci√≥n para formatear la lista de compra para WhatsApp
///function formatShoppingListForWhatsApp() {
  // Obtener los valores de los campos del formulario

 /// const documentType = $('#documentType').val();
 /// const deliveryOption = $('#deliveryOption').val();
  ///const clientName = $('#clientName').val();
  ///const clientAddress = $('#clientAddress').val();
 /// const clientPhone = $('#clientPhone').val();

  
///  let formattedList = '*üìã Lista de Compra:*\n\n';
///  for (let i = 0; i < shoppingList.length; i++) {
   /// const item = shoppingList[i];
   /// formattedList += `üõí *${item.cantidad}x ${item.producto}* - _Total: _$${item.total}_\n`;
  ///  formattedList += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n'; // L√≠nea decorativa
 /// }
  ///formattedList += `\nüí∞ *Total de Compra:* _$${totalPurchase.toFixed(2)}_`;

  // Agregar informaci√≥n del cliente y opciones de entrega
  ///formattedList += `\n\n*Informaci√≥n del Cliente:*\nNombre: ${clientName}\nDirecci√≥n: ${clientAddress}\nTel√©fono: ${clientPhone}\nTipo de Documento: ${documentType}\nOpci√≥n de Entrega: ${deliveryOption}`;

  // Agregar enlace al GIF
///  const gifURL = 'https://media2.giphy.com/media/3o72Fj8mcEJC5InEFa/200w.webp?cid=ecf05e47iogotsnrkib2qj85yqifajv7o5c4j9e7bws0e8f2&ep=v1_gifs_related&rid=200w.webp&ct=g'; // URL directa al GIF
 /// formattedList += `\n\n¬°Mira este GIF incre√≠ble!\n${gifURL}\n\n`;


///}




//wwwwwwwwwwwwwwwwwewwwww
   
   
 function formatShoppingListForWhatsApp() {

   const selectedOptionText = $('#documentType option:selected').text();
   const fechaHoraActual = new Date().toLocaleString(); // Obtiene la fecha y hora actual en formato local
   const shoppingListHeaderText = $('#shoppingList h4').text(); // Obtiene el texto dentro de <h4>
   const deliveryOption = $('#deliveryOption option:selected').text();  
   // const documentType = $('#documentType').val();
  //const deliveryOption = $('#deliveryOption').val();
  const clientName = $('#clientName').val();
  const clientAddress = $('#clientAddress').val();
  const clientPhone = $('#clientPhone').val();
// clientName = $('#clientName').val();
 //let formattedList = '* Lista de Compra:*\n';
 let formattedList = `*${shoppingListHeaderText}:*\n`; // Utiliza el texto obtenido dentro de <h4>
   formattedList += `  *${selectedOptionText}* - N¬∞ ${fechaHoraActual}  üìã \n`;
  // formattedList += `*Comprobante:* ${selectedOptionText}\n`;
   //formattedList += `*Comprobante:* ${documentType}*\n`;
  // formattedList += `*Opci√≥n de entrega:* ${deliveryOption}\n`;
  formattedList += `*Opci√≥n de entrega:* ${deliveryOption}\n`;
   //formattedList += `*Opcion de entrega:* ${deliveryOption}*\n`;
   formattedList += `*Nombre del Cliente:* ${clientName}\n`;
   formattedList += `*Direcci√≥n:* ${clientAddress}\n`;
   formattedList += `*Celular:* ${clientPhone}\n\n\n`;
   for (let i = 0; i < shoppingList.length; i++) {
    const item = shoppingList[i];
    //formattedList += `üõí *${item.cantidad}x ${item.producto}* - _Total: _$${item.total}_\n`;
    formattedList += `üõí *${item.cantidad}-* *${item.producto}* - Precio: _S/${item.precio}_ - _Total: _S/${item.total}_\n`;

    formattedList += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n'; // L√≠nea decorativa
  }
  formattedList += `\nüí∞ *Total de Compra:* _S/${totalPurchase.toFixed(2)}_`;

  // Agregar enlace al GIF
  //const gifURL = 'https://media2.giphy.com/media/3o72Fj8mcEJC5InEFa/200w.webp?cid=ecf05e47iogotsnrkib2qj85yqifajv7o5c4j9e7bws0e8f2&ep=v1_gifs_related&rid=200w.webp&ct=g'; // URL directa al GIF
  //formattedList += `\n\n¬°Mira este GIF incre√≠ble!\n${gifURL}\n\n`;

  return formattedList;
 }
//wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww

 //pppoppppppppppppddddddddddddfffffffffffffff     
// Funci√≥n para formatear la lista de compra para el PDF
function formatShoppingListForPDF() {
  let formattedList = 'Lista de Compra:\n\n';
  for (let i = 0; i < shoppingList.length; i++) {
    const item = shoppingList[i];
    formattedList += `${item.cantidad}x ${item.producto} - Total: $${item.total}\n`;
    //formattedList += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n'; // L√≠nea decorativa
  }
  formattedList += `\nTotal de Compra: $${totalPurchase.toFixed(2)}`;

  return formattedList;
}

// Descargar PDF al hacer clic en el bot√≥n "Descargar PDF"
///$('#downloadPDFButton').on('click', async function () {
  ///try {
    // Crear el objeto PDF en blanco
    ///const pdfDoc = await PDFLib.PDFDocument.create();
   // Establecer el ancho y alto de la p√°gina
    ///const pageWidth = 5.5 * 28.35; // 5.5 cms
  ///  const pageHeight = 15 * 28.35; // 11 cent√≠metros
  ///  const page = pdfDoc.addPage([pageWidth, pageHeight]);
  ///  const yToHeightRatio = 25.454545;

    // Agregar una nueva p√°gina al PDF
    //const page = pdfDoc.addPage();

    // Establecer el tama√±o y la posici√≥n del texto
   /// const textSize = 6;
   /// const textX = 20;
   /// const textY =(yToHeightRatio *(pageHeight/ 28.35))+((yToHeightRatio/100)*(pageHeight/ 28.35))  ;

    // Obtener la lista de compra formateada para PDF
   /// const formattedListForPDF = formatShoppingListForPDF();

    // Agregar texto a la p√°gina utilizando la fuente predeterminada
    ///page.drawText(formattedListForPDF, { x: textX, y: textY, size: textSize });

    // Guardar el PDF como un blob
    ///const pdfBytes = await pdfDoc.save();

    // Crear el enlace de descarga para el PDF
   /// const downloadLink = document.createElement('a');
  ///  downloadLink.href = URL.createObjectURL(new Blob([pdfBytes], { type: 'application/pdf' }));
  ///  downloadLink.download = 'Lista_de_Compra.pdf';

    // Simular un clic en el enlace para abrir la ventana de descarga
  ///  downloadLink.click();
 /// } catch (error) {
   /// alert('Error al crear/descargar el PDF: ' + error.message);
  ///  }
///});
//pppppppppppppdddddddddddddddddddddddddddddddfffffffffffff
$('#downloadPDFButton').on('click', async function () {
  try {
    // Crear el documento PDF
    const pdfDoc = await PDFLib.PDFDocument.create();

    // Definir el ancho de la p√°gina
    const pageWidth = 5.5 * 28.35; // Ancho de p√°gina en cent√≠metros

    // Definir el tama√±o inicial de la p√°gina y la posici√≥n del texto
    let pageHeight = 15 * 28.35; // Alto de p√°gina en cent√≠metros
    const margin = 20; // Margen de la p√°gina
    const textSize = 6; // Tama√±o del texto
    const textX = 20; // Posici√≥n X del texto
    let textY = margin; // Posici√≥n Y del texto

    // Obtener la lista de compra formateada para el PDF
    const formattedListForPDF = formatShoppingListForPDF();

    // Calcular la altura total requerida para la lista de compras
    const lineHeight = 18; // Altura de l√≠nea de texto
    const additionalItemsHeight = formattedListForPDF.split('\n').length * lineHeight;

    // Calcular la altura total de la p√°gina
    pageHeight = margin * 2 + additionalItemsHeight;
    textY=pageHeight-margin;
    // Agregar una nueva p√°gina al PDF con las dimensiones calculadas
    const page = pdfDoc.addPage([pageWidth, pageHeight]);

    // Agregar texto a la p√°gina utilizando la fuente predeterminada
    page.drawText(formattedListForPDF, { x: textX, y: textY, size: textSize });

    // Guardar el PDF como un blob
    const pdfBytes = await pdfDoc.save();

    // Crear el enlace de descarga para el PDF
    const downloadLink = document.createElement('a');
    downloadLink.href = URL.createObjectURL(new Blob([pdfBytes], { type: 'application/pdf' }));
    downloadLink.download = 'Lista_de_Compra.pdf';

    // Simular un clic en el enlace para abrir la ventana de descarga
    downloadLink.click();
  } catch (error) {
    alert('Error al crear/descargar el PDF: ' + error.message);
  }
});


//ppppppppppppppppppppppppppdddddddddddddddddddddfffffffffffddd
// Funci√≥n para compartir en WhatsApp al hacer clic en el bot√≥n
$('#whatsappButton').on('click', function () {
  try {
    // Obtener la lista de compra formateada para WhatsApp
    const formattedListForWhatsApp = formatShoppingListForWhatsApp();

    // Abrir WhatsApp con el mensaje
    const whatsappLink = 'whatsapp://send?text=' + encodeURIComponent(formattedListForWhatsApp);

    // Redirigir a la aplicaci√≥n de WhatsApp o abrir en una nueva ventana
    window.open(whatsappLink, '_blank');
  } catch (error) {
    alert('Error al compartir en WhatsApp: ' + error.message);
  }
});
// fin botones Whatsapp y pdf


          // Agregar evento cuando el modal se muestre
            $('#quantityModal').on('shown.bs.modal', function () {
            // Establecer el valor predeterminado en 1
            $('#quantityInput').val('1');
            
            // Seleccionar todo el texto en el campo de cantidad
            $('#quantityInput').select();
        });
        // fin agregar evento modal

  //9999999999999999999999999999999999999999
        
        // Funci√≥n para actualizar la lista de compra en la interfaz
      ///  function updateShoppingList() {
        ///  var shoppingItems = $('#shoppingItems');
         /// var totalPurchaseElement = $('#totalPurchase');

          // Limpiar lista de compra
        ///  shoppingItems.empty();

          // Construir y agregar nuevos elementos a la lista de compra
       ///   for (var i = 0; i < shoppingList.length; i++) {
          ///  var item = shoppingList[i];
            ///var listItem = '<li class="shopping-item">' +
           ///    '<span class="item-quantity">' + item.cantidad + 'x</span>' +
            ///   '<span class="item-description">' + item.producto + '</span>' +
            ///   '<span class="item-price">Precio: $' + item.precio + '</span>' +
           ///    '<span class="item-total">Total: $' + item.total + '</span>' +
              /// '</li>';


         ///   shoppingItems.append(listItem);
       ///   }//fin for

          // Actualizar el total de la compra global
      ///    totalPurchaseElement.text('$' + totalPurchase.toFixed(2));
     ///   }


        
        //fin actualizar la lista compras

  //99999999999999999999999999999999999999

   // Funci√≥n para actualizar la lista de compra en la interfaz
function updateShoppingList() {
    var shoppingItems = $('#shoppingItems');
    var totalPurchaseElement = $('#totalPurchase');

    // Limpiar lista de compra
    //shoppingItems.empty();
    $('.shopping-item').remove();

  
    // Construir y agregar nuevos elementos a la lista de compra
    for (var i = 0; i < shoppingList.length; i++) {
        var item = shoppingList[i];
        var listItem = '<li class="shopping-item">' +
            '<span class="item-quantity">' + item.cantidad + 'x</span>' +
            '<span class="item-description">' + item.producto + '</span>' +
            '<span class="item-price">Precio: S/' + item.precio + '</span>' +
            '<span class="item-total">Total: S/' + item.total + '</span>' +
            '</li>';

        shoppingItems.append(listItem);
    }//fin for

// Actualizar el total de la compra global
var totalPurchase = 0;
for (var i = 0; i < shoppingList.length; i++) {
    // Obtener el total del elemento actual en la lista de compras
    var totalItem = parseFloat(shoppingList[i].total.replace('S/', '')); // Eliminar el signo '$' antes de convertir a flotante
    totalPurchase += totalItem;
}
totalPurchaseElement.text('S/' + totalPurchase.toFixed(2)); // Agregar el signo '$' al total de la compra global
}   
        
  //99999999999999999999999999999999000000
        
//:::;;;;;;;;;;;;codigo modal edicion::::::::::':::    
       

        
    // Agregar controlador de eventos blur al campo de cantidad
    $('#editQuantity').on('blur', function() {
        // Obtener los valores actuales de cantidad y precio
        var cantidad = parseFloat($(this).val());
        var precio = parseFloat($('#editPrice').val());

        // Verificar si ambos valores son num√©ricos
        if (!isNaN(cantidad) && !isNaN(precio)) {
            // Calcular el total y actualizar el campo correspondiente
            $('#editTotal').val((cantidad * precio).toFixed(2));
        }
    });

    // Agregar controlador de eventos blur al campo de precio
    $('#editPrice').on('blur', function() {
        // Obtener los valores actuales de cantidad y precio
        var cantidad = parseFloat($('#editQuantity').val());
        var precio = parseFloat($(this).val());

        // Verificar si ambos valores son num√©ricos
        if (!isNaN(cantidad) && !isNaN(precio)) {
            // Calcular el total y actualizar el campo correspondiente
            $('#editTotal').val((cantidad * precio).toFixed(2));
        }
    });
                          

    
    
    // Agregar controlador de eventos input al campo de cantidad
    $('#editQuantity').on('input', function() {
        // Obtener el valor actual del campo de cantidad
        var value = $(this).val();

        // Filtrar caracteres no num√©ricos y m√°s de un punto decimal
        value = value.replace(/[^\d.]/g, ''); // Mantener solo d√≠gitos y puntos decimales
        value = value.replace(/^(\d*\.\d*)\..*$/, '$1'); // Mantener solo un punto decimal

        // Actualizar el valor del campo de cantidad con la entrada filtrada
        $(this).val(value);
    });

    // Agregar controlador de eventos input al campo de precio
    $('#editPrice').on('input', function() {
        // Obtener el valor actual del campo de precio
        var value = $(this).val();

        // Filtrar caracteres no num√©ricos y m√°s de un punto decimal
        value = value.replace(/[^\d.]/g, ''); // Mantener solo d√≠gitos y puntos decimales
        value = value.replace(/^(\d*\.\d*)\..*$/, '$1'); // Mantener solo un punto decimal

        // Actualizar el valor del campo de precio con la entrada filtrada
        $(this).val(value);
    });

    // Agregar controlador de eventos input al campo de total
    $('#editTotal').on('input', function() {
        // Obtener el valor actual del campo de total
        var value = $(this).val();

        // Filtrar caracteres no num√©ricos y m√°s de un punto decimal
        value = value.replace(/[^\d.]/g, ''); // Mantener solo d√≠gitos y puntos decimales
        value = value.replace(/^(\d*\.\d*)\..*$/, '$1'); // Mantener solo un punto decimal

        // Actualizar el valor del campo de total con la entrada filtrada
        $(this).val(value);
    });
      

 

                                 

    // Agregar controlador de eventos clic al contenedor de la lista de compras
    $('#shoppingItems').on('click', '.shopping-item', function() {
        // Remover la clase 'active' de todos los elementos de la lista de compras
        $('.shopping-item').removeClass('active');
        
        // Agregar la clase 'active' al elemento clicado para resaltarlo visualmente
        $(this).addClass('active');

        // Obtener los datos del elemento clicado
        var cantidad = $(this).find('.item-quantity').text().trim().replace('x', ''); // Eliminar 'x' y espacios
        var descripcion = $(this).find('.item-description').text().trim();
        var precio = $(this).find('.item-price').text().trim().replace('Precio: S/', ''); // Eliminar 'Precio: $'
        var total = $(this).find('.item-total').text().trim().replace('Total: S/', ''); // Eliminar 'Total: $'

        // Llenar el modal con los datos del elemento clicado
        $('#editItemModal').modal('show'); // Mostrar el modal
        $('#editDescription').val(descripcion);
        $('#editQuantity').val(cantidad);
        $('#editPrice').val(precio);
        $('#editTotal').val(total);
    });

        // Agregar controlador de eventos clic al bot√≥n "Guardar Cambios" del modal
$('#saveChangesBtn').on('click', function() {
    // Obtener el √≠ndice del elemento activo en la lista de compras
    var index = $('.shopping-item').index($('.shopping-item.active'));
    
    // Verificar si se ha seleccionado un elemento
    if (index >= 0) {
        // Actualizar los datos del elemento correspondiente en shoppingList
        shoppingList[index].cantidad = $('#editQuantity').val();
        shoppingList[index].producto = $('#editDescription').val();
        shoppingList[index].precio = $('#editPrice').val();
        shoppingList[index].total = $('#editTotal').val();

        // Actualizar la lista de compras en la interfaz
        updateShoppingList();

        // Ocultar el modal despu√©s de guardar los cambios
        $('#editItemModal').modal('hide');
    } else {
        // Mostrar mensaje de error si no se seleccion√≥ ning√∫n elemento
        alert('Por favor, selecciona un elemento de la lista de compras.');
    }
});



        
        // Agregar controlador de eventos clic al bot√≥n "Borrar" del modal
    $('#deleteItemBtn').on('click', function() {
    // Obtener el elemento activo de la lista de compras
    var shoppingItem = $('.shopping-item.active');
    
    // Verificar si se ha seleccionado un elemento
    if (shoppingItem.length > 0) {
        // Obtener el √≠ndice del elemento en shoppingList
        var index = $('.shopping-item').index(shoppingItem);

        // Eliminar el elemento de shoppingList
        shoppingList.splice(index, 1);

        // Actualizar la lista de compras en la interfaz
        updateShoppingList();

        // Ocultar el modal despu√©s de borrar el elemento
        $('#editItemModal').modal('hide');
    } else {
        // Mostrar mensaje de error si no se seleccion√≥ ning√∫n elemento
        alert('Por favor, selecciona un elemento de la lista de compras.');
    }
});


    


  

//::::::::::::;;;;fin codigo modal edicion:::::::::::
      }
    });
  });
</script>
<!-- Modal -->
<div class="modal fade" id="quantityModal" tabindex="-1" role="dialog" aria-labelledby="quantityModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="quantityModalLabel">Detalles del Producto</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="quantityForm">
          <div class="form-group">
            <label for="descriptionInput">Descripci√≥n:</label>
            <textarea class="form-control" id="descriptionInput" rows="3"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="quantityInput">Cantidad:</label>
              <input type="number" class="form-control" id="quantityInput" value="1">
            </div>
            <div class="form-group col-md-6">
              <label for="priceInput">Precio:</label>
              <input type="text" class="form-control" id="priceInput">
            </div>
          </div>
          <div class="form-group">
            <label for="imageInput">Imagen:</label>
            <div id="imageContainer"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        <button type="submit" class="btn btn-primary" id="addQuantityBtn">Agregar</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal fin -->

<!-- Nuevo Modal para Edici√≥n de Elementos -->
<div class="modal fade" id="editItemModal" tabindex="-1" role="dialog" aria-labelledby="editItemModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editItemModalLabel">Editar Elemento de Lista de Compras</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Formulario de Edici√≥n de Elemento -->
        <form id="editItemForm">
          <div class="form-group">
            <label for="editDescription">Descripci√≥n:</label>
            <textarea class="form-control" id="editDescription" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="editQuantity">Cantidad:</label>
            <input type="text" class="form-control" id="editQuantity">
          </div>
          <div class="form-group">
            <label for="editPrice">Precio:</label>
            <input type="text" class="form-control" id="editPrice">
          </div>
          <div class="form-group">
            <label for="editTotal">Total:</label>
            <input type="text" class="form-control" id="editTotal">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" id="deleteItemBtn">Borrar</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-primary" id="saveChangesBtn">Guardar Cambios</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal edicion fin -->

  
</body>
</html>
